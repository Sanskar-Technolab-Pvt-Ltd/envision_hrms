[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2024-10-14 18:47:47.744926",
  "module": "Envision HRMS",
  "name": "Set checkin date",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Employee Checkin",
  "script": "# formatted_time = frappe.utils.formatdate(doc.time, \"yyyy-mm-dd\") + doc.time[10:]\n# date_time = frappe.utils.get_datetime(formatted_time)\n# doc.custom_date = date_time.date()\n\ndate_time = frappe.utils.get_datetime(doc.time)\ndoc.custom_date = date_time.date()",
  "script_type": "DocType Event"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-08-04 12:59:13.278592",
  "module": "Envision HRMS",
  "name": "Employee Checkin Set Type IN OUT",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Employee Checkin",
  "script": " # Extract the date part from the datetime field\ncheckin_date = frappe.utils.getdate(doc.time)  # Returns a date object\n\n# Convert date to string to form a proper datetime range filter\nstart_datetime = str(checkin_date) + \" 00:00:00\"\nend_datetime = str(checkin_date) + \" 23:59:59\"\n\n# Fetch all check-ins for the employee on the same date, sorted by time\nexisting_checkins = frappe.get_all(\n    \"Employee Checkin\",\n    filters={\n        \"employee\": doc.employee,\n        \"time\": [\"between\", [start_datetime, end_datetime]]\n    },\n    fields=[\"name\", \"time\", \"log_type\"],\n    order_by=\"time asc\"\n)\n\n# # If it's the first check-in for the day, set as \"IN\", otherwise \"OUT\"\nif len(existing_checkins) == 0:\n    doc.log_type = \"IN\"\nelse:\n\n    # Combine existing times + current log time\n    all_logs = existing_checkins + [{\"name\": None, \"time\": doc.time}]\n    \n    # Convert all times to datetime objects for accurate sorting\n    for log in all_logs:\n        log[\"time\"] = frappe.utils.get_datetime(log[\"time\"])\n    \n    # Sort by time\n    sorted_logs = sorted(all_logs, key=lambda x: x[\"time\"])\n    \n    # First log is IN, rest are OUT\n    for idx, log in enumerate(sorted_logs):\n        if log[\"name\"]:\n            # Existing logs - update their log_type\n            frappe.db.set_value(\"Employee Checkin\", log[\"name\"], \"log_type\", \"IN\" if idx == 0 else \"OUT\")\n        else:\n            # This is the current log being inserted\n            doc.log_type = \"IN\" if idx == 0 else \"OUT\"\n\n# # If it's the first check-in for the day, set as \"IN\", otherwise \"OUT\"\n# if len(existing_checkins) == 0:\n#     doc.log_type = \"IN\"\n# else:\n#     doc.log_type = \"OUT\"\n",
  "script_type": "DocType Event"
 }
]